import os
from importlib.machinery import SourceFileLoader
maindir = os.path.abspath(os.path.dirname(__file__))
T = SourceFileLoader('Tile', os.path.join(maindir, 'Tile.py')).load_module()

class Level:
    def __init__(self, level):
        match level:
            case 0:
                self.level_num = 0
                self.id = 'Level 0: The Backrooms'
                level_list = [
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                ]
                self.start_x, self.start_y = 8, 1
            case 1:
                self.level_num = 1
                self.id = 'Level 1: The Basics'
                level_list = [
                    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],
                    [1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,1,3,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1],
                    [1,0,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,5,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1],
                    [1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1],
                    [1,0,0,0,0,0,1,0,4,1,1,0,0,0,0,0,0,0,4,1],
                    [1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,1,1,1],
                ]
                self.start_x, self.start_y = 1, 2
            case 2:
                self.level_num = 2
                self.id = 'Level 2: Moving On Up'
                level_list = [
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1],
                    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                ]
                self.start_x, self.start_y = 12, 1
        
        blocks_layout = []
        [blocks_layout.append([0]*20) for i in range(15)]
        for i in range(15):
            for j in range(20):
                blocks_layout[i][j] = T.Tile(level_list[i][j], i, j)
        self.level = blocks_layout

    def get_level(self):
        return self.level

    def get_rect_list(self):
        rect_list = []
        for i in range(15):
            for j in range(20):
                if self.level[i][j].collision:
                    rect_list.append((self.level[i][j].get_img_rect(), self.level[i][j].type, self.level[i][j].collision))
        return rect_list

    def get_start_coords(self):
        return self.start_x, self.start_y

    def update_level(self, screen):
        for i in range(15):
            for j in range(20):
                p1,p2 = self.level[i][j].get_img(), self.level[i][j].get_img_rect()
                screen.blit(p1,p2)